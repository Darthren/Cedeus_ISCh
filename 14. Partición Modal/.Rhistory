for (c in seq(files.viajes)){
ciudad.nombre <- ciudades[c]
if (ciudad.nombre %in% c("Gran Santiago")){
next()
}
else if (ciudad.nombre == "Gran Coquimbo") {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje"),
c("IDFolio", "IDPersona", "IDViaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(sum(ModoAgregado == "Transporte Privado/Auto")/n(),2),
'Transporte Publico' = round(sum(ModoAgregado == "Transporte Publico")/n(),2),
Bicicleta = round(sum(ModoAgregado == "Bicicleta")/n(),2),
Caminata = round(sum(ModoAgregado == "Caminata")/n(),2),
Otros = round(sum(ModoAgregado == "Otros")/n(),2),
Total = 1)
} else {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje", "Factor_"),
c("IDFolio", "IDPersona", "IDViaje", "Factor_Viaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "Factor_Viaje", "IDModo"))
viajes$Factor_Viaje <- as.numeric(gsub(",", ".", viajes$Factor_Viaje))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(sum(Factor_Viaje[ModoAgregado == "Transporte Privado/Auto"])/sum(Factor_Viaje),2),
'Transporte Publico' = round(sum(Factor_Viaje[ModoAgregado == "Transporte Publico"])/sum(Factor_Viaje),2),
Bicicleta = round(sum(Factor_Viaje[ModoAgregado == "Bicicleta"])/sum(Factor_Viaje),2),
Caminata = round(sum(Factor_Viaje[ModoAgregado == "Caminata"])/sum(Factor_Viaje),2),
Otros = round(sum(Factor_Viaje[ModoAgregado == "Otros"])/sum(Factor_Viaje),2),
Total = 1)
}
particion.modal <- rbind(particion.modal, viajes.summary)
}
View(particion.modal)
# Script para calcular la partición modal de cada ciudad.
# Input: Tablas de Viajes, encontradas dentro de la EOD de cada ciudad.
#        Tablas con las reclasificaciones de los modos de transporte de cada viaje.
#         para agruparlos en 5 categorías.
# Output: Tabla con la partición modal de cada ciudad.
library(data.table); library(dplyr)
# Carpeta donde se encuentra el script. Modificar según necesidades del usuario.
setwd("C:/Users/Rodrigo Villegas/Documents/Cedeus_ISCh/Cedeus_ISCh/14. Partición Modal/")
# Funciones de ayuda:
# Corrector.nombre:
#   Input: nombres de columna, data.frame, variable a buscar (persona, tiempo, etc...)
#          variable a cambiar (IDPersona, TiempoViajes, etc)
#   Output: Dataset con nombre de variable cambiado.
# Nota: Acepta sólo una variable.
Corrector.nombre <- function(dataset, nombres, variable.buscar, variable.cambiar, exact.match = F){
if (exact.match == T){
colname <- grep(paste("^", variable.buscar, "$", sep = ""), nombres, ignore.case = T)
} else {
colname <- grep(variable.buscar, nombres, ignore.case = T)
}
if (colnames(dataset)[colname] != variable.cambiar){
colnames(dataset)[colname] <- variable.cambiar
}
return(dataset)
}
# Estandarizador:
#   Input: Tabla EOD en bruto
#   Output: Tabla EOD estandarizada
#   Nota: cuando una variable tiene el sufijo "_", se ejecuta "exact.macth" de Corrector.nombre
Estandarizador <- function(Tabla_EOD, variables.buscar, variables.cambiar){
for (i in seq(variables.buscar)){
if (grepl("_", variables.buscar[i])){
variables.buscar[i] <- gsub("_", "", variables.buscar[i])
Tabla_EOD <- Corrector.nombre(Tabla_EOD, colnames(Tabla_EOD), variables.buscar[i], variables.cambiar[i], exact.match = T)
} else {
Tabla_EOD <- Corrector.nombre(Tabla_EOD, colnames(Tabla_EOD), variables.buscar[i], variables.cambiar[i])
}
}
return(Tabla_EOD)
}
ciudades <- read.csv("Otros/Ciudades_Cedeus.csv")
ciudades <- unique(ciudades$Ciudad)
ciudades <- ciudades[!(ciudades =="Gran Concepcion")]
ciudades <- sort(ciudades)
files.viajes <- list.files("Raw_Data", pattern = "viajes") %>%
sort()
files.modo <- list.files("Raw_Data", pattern = "ModoReclass") %>%
sort()
particion.modal <- data.table()
for (c in seq(files.viajes)){
ciudad.nombre <- ciudades[c]
if (ciudad.nombre %in% c("Gran Santiago")){
next()
}
else if (ciudad.nombre == "Gran Coquimbo") {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje"),
c("IDFolio", "IDPersona", "IDViaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(ModoAgregado == "Transporte Privado/Auto")/n(),2),
'Transporte Publico' = round(100*sum(ModoAgregado == "Transporte Publico")/n(),2),
Bicicleta = round(100*sum(ModoAgregado == "Bicicleta")/n(),2),
Caminata = round(100*sum(ModoAgregado == "Caminata")/n(),2),
Otros = round(100*sum(ModoAgregado == "Otros")/n(),2),
Total = 1)
} else {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje", "Factor_"),
c("IDFolio", "IDPersona", "IDViaje", "Factor_Viaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "Factor_Viaje", "IDModo"))
viajes$Factor_Viaje <- as.numeric(gsub(",", ".", viajes$Factor_Viaje))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(Factor_Viaje[ModoAgregado == "Transporte Privado/Auto"])/sum(Factor_Viaje),2),
'Transporte Publico' = round(100*sum(Factor_Viaje[ModoAgregado == "Transporte Publico"])/sum(Factor_Viaje),2),
Bicicleta = round(100*sum(Factor_Viaje[ModoAgregado == "Bicicleta"])/sum(Factor_Viaje),2),
Caminata = round(100*sum(Factor_Viaje[ModoAgregado == "Caminata"])/sum(Factor_Viaje),2),
Otros = round(100*sum(Factor_Viaje[ModoAgregado == "Otros"])/sum(Factor_Viaje),2),
Total = 1)
}
particion.modal <- rbind(particion.modal, viajes.summary)
}
View(particion.modal)
ciudad.nombre <- "Gran Santiago"
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje"),
c("IDFolio", "IDPersona", "IDViaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
c <- 3
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje"),
c("IDFolio", "IDPersona", "IDViaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";")
View(viajes)
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("hogar", "persona", "viaje_"),
c("IDFolio", "IDPersona", "IDViaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("hogar", "persona", "Viaje_"),
c("IDFolio", "IDPersona", "IDViaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("hogar", "persona", "Viaje_"),
c("IDFolio", "IDPersona", "IDViaje", "ModoAgregado")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes$ModoAgregado
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("hogar", "persona", "Viaje_", "ModoAgregado"),
c("IDFolio", "IDPersona", "IDViaje", "IDModo")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";")
View(viajes)
for (c in seq(files.viajes)){
ciudad.nombre <- ciudades[c]
if (ciudad.nombre %in% c("Gran Santiago")){
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("hogar", "persona", "Viaje_", "ModoAgregado"),
c("IDFolio", "IDPersona", "IDViaje", "IDModo")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(ModoAgregado == "Transporte Privado/Auto")/n(),2),
'Transporte Publico' = round(100*sum(ModoAgregado == "Transporte Publico")/n(),2),
Bicicleta = round(100*sum(ModoAgregado == "Bicicleta")/n(),2),
Caminata = round(100*sum(ModoAgregado == "Caminata")/n(),2),
Otros = round(100*sum(ModoAgregado == "Otros")/n(),2),
Total = 1)
}
else if (ciudad.nombre == "Gran Coquimbo") {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje"),
c("IDFolio", "IDPersona", "IDViaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(ModoAgregado == "Transporte Privado/Auto")/n(),2),
'Transporte Publico' = round(100*sum(ModoAgregado == "Transporte Publico")/n(),2),
Bicicleta = round(100*sum(ModoAgregado == "Bicicleta")/n(),2),
Caminata = round(100*sum(ModoAgregado == "Caminata")/n(),2),
Otros = round(100*sum(ModoAgregado == "Otros")/n(),2),
Total = 1)
} else {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje", "Factor_"),
c("IDFolio", "IDPersona", "IDViaje", "Factor_Viaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "Factor_Viaje", "IDModo"))
viajes$Factor_Viaje <- as.numeric(gsub(",", ".", viajes$Factor_Viaje))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(Factor_Viaje[ModoAgregado == "Transporte Privado/Auto"])/sum(Factor_Viaje),2),
'Transporte Publico' = round(100*sum(Factor_Viaje[ModoAgregado == "Transporte Publico"])/sum(Factor_Viaje),2),
Bicicleta = round(100*sum(Factor_Viaje[ModoAgregado == "Bicicleta"])/sum(Factor_Viaje),2),
Caminata = round(100*sum(Factor_Viaje[ModoAgregado == "Caminata"])/sum(Factor_Viaje),2),
Otros = round(100*sum(Factor_Viaje[ModoAgregado == "Otros"])/sum(Factor_Viaje),2),
Total = 1)
}
particion.modal <- rbind(particion.modal, viajes.summary)
}
c
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("hogar", "persona", "Viaje_", "ModoAgregado"),
c("IDFolio", "IDPersona", "IDViaje", "IDModo")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
View(viajes)
View(viajes.modo)
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ";"))
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("hogar", "persona", "Viaje_", "ModoAgregado"),
c("IDFolio", "IDPersona", "IDViaje", "IDModo")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ";"))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""), sep = ";")
View(viajes.modo)
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(ModoAgregado == "Transporte Privado/Auto")/n(),2),
'Transporte Publico' = round(100*sum(ModoAgregado == "Transporte Publico")/n(),2),
Bicicleta = round(100*sum(ModoAgregado == "Bicicleta")/n(),2),
Caminata = round(100*sum(ModoAgregado == "Caminata")/n(),2),
Otros = round(100*sum(ModoAgregado == "Otros")/n(),2),
Total = 1)
View(viajes.summary)
View(viajes.modo)
IDModo <- c(17,18,8,12,13,14,15,16,1,6,2,3,4,5,7,9,10,11)
Modo <- c("Caminata", "Bicicleta", "Auto - Metro", "Taxi - Metro", "Otros - Metro", "Otros - Bus TS",
"Otros - Bus TS - Metro", "Otros", "Auto", "Taxi ", "Bus TS",
"Bus no TS", "Metro", "Taxi Colectivo", "Bus TS - Bus no TS", "Bus TS - Metro",
"Bus no TS - Metro", "Taxi Colectivo - Metro")
Santiago <- data.frame(IDModo, Modo)
ModoAgregado <- c("Caminata", "Bicicleta", rep("Transporte Publico", 5), "Otros", rep("Transporte Privado/Auto", 2),
rep("Transporte Publico", 8))
numero <- c(17,18,8,12,13,14,15,16,1,6,2,3,4,5,7,9,10,11)
Tabla <- data.frame(ModoAgregado, Modo)
Santiago$Final <- Santiago[match(Tabla[["Modo"]], Santiago[["Modo"]] ), "ModoAgregado"]
final <- merge(Otras.ciudades, Tabla, by.x= "Modo", by.y = "Modo", sort = F)
View(final)
write.csv(Tabla, paste("Gran Santiago", "_ModoReclass.csv", sep = ""), row.names = F)
View(Tabla)
for (c in seq(files.viajes)){
ciudad.nombre <- ciudades[c]
if (ciudad.nombre %in% c("Gran Santiago")){
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("hogar", "persona", "Viaje_", "ModoAgregado"),
c("IDFolio", "IDPersona", "IDViaje", "IDModo")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""), sep = ";")
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(ModoAgregado == "Transporte Privado/Auto")/n(),2),
'Transporte Publico' = round(100*sum(ModoAgregado == "Transporte Publico")/n(),2),
Bicicleta = round(100*sum(ModoAgregado == "Bicicleta")/n(),2),
Caminata = round(100*sum(ModoAgregado == "Caminata")/n(),2),
Otros = round(100*sum(ModoAgregado == "Otros")/n(),2),
Total = 1)
}
else if (ciudad.nombre == "Gran Coquimbo") {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje"),
c("IDFolio", "IDPersona", "IDViaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(ModoAgregado == "Transporte Privado/Auto")/n(),2),
'Transporte Publico' = round(100*sum(ModoAgregado == "Transporte Publico")/n(),2),
Bicicleta = round(100*sum(ModoAgregado == "Bicicleta")/n(),2),
Caminata = round(100*sum(ModoAgregado == "Caminata")/n(),2),
Otros = round(100*sum(ModoAgregado == "Otros")/n(),2),
Total = 1)
} else {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje", "Factor_"),
c("IDFolio", "IDPersona", "IDViaje", "Factor_Viaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "Factor_Viaje", "IDModo"))
viajes$Factor_Viaje <- as.numeric(gsub(",", ".", viajes$Factor_Viaje))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(Factor_Viaje[ModoAgregado == "Transporte Privado/Auto"])/sum(Factor_Viaje),2),
'Transporte Publico' = round(100*sum(Factor_Viaje[ModoAgregado == "Transporte Publico"])/sum(Factor_Viaje),2),
Bicicleta = round(100*sum(Factor_Viaje[ModoAgregado == "Bicicleta"])/sum(Factor_Viaje),2),
Caminata = round(100*sum(Factor_Viaje[ModoAgregado == "Caminata"])/sum(Factor_Viaje),2),
Otros = round(100*sum(Factor_Viaje[ModoAgregado == "Otros"])/sum(Factor_Viaje),2),
Total = 1)
}
particion.modal <- rbind(particion.modal, viajes.summary)
}
View(particion.modal)
# Script para calcular la partición modal de cada ciudad.
# Input: Tablas de Viajes, encontradas dentro de la EOD de cada ciudad.
#        Tablas con las reclasificaciones de los modos de transporte de cada viaje.
#         para agruparlos en 5 categorías.
# Output: Tabla con la partición modal de cada ciudad.
library(data.table); library(dplyr)
# Carpeta donde se encuentra el script. Modificar según necesidades del usuario.
setwd("C:/Users/Rodrigo Villegas/Documents/Cedeus_ISCh/Cedeus_ISCh/14. Partición Modal/")
# Funciones de ayuda:
# Corrector.nombre:
#   Input: nombres de columna, data.frame, variable a buscar (persona, tiempo, etc...)
#          variable a cambiar (IDPersona, TiempoViajes, etc)
#   Output: Dataset con nombre de variable cambiado.
# Nota: Acepta sólo una variable.
Corrector.nombre <- function(dataset, nombres, variable.buscar, variable.cambiar, exact.match = F){
if (exact.match == T){
colname <- grep(paste("^", variable.buscar, "$", sep = ""), nombres, ignore.case = T)
} else {
colname <- grep(variable.buscar, nombres, ignore.case = T)
}
if (colnames(dataset)[colname] != variable.cambiar){
colnames(dataset)[colname] <- variable.cambiar
}
return(dataset)
}
# Estandarizador:
#   Input: Tabla EOD en bruto
#   Output: Tabla EOD estandarizada
#   Nota: cuando una variable tiene el sufijo "_", se ejecuta "exact.macth" de Corrector.nombre
Estandarizador <- function(Tabla_EOD, variables.buscar, variables.cambiar){
for (i in seq(variables.buscar)){
if (grepl("_", variables.buscar[i])){
variables.buscar[i] <- gsub("_", "", variables.buscar[i])
Tabla_EOD <- Corrector.nombre(Tabla_EOD, colnames(Tabla_EOD), variables.buscar[i], variables.cambiar[i], exact.match = T)
} else {
Tabla_EOD <- Corrector.nombre(Tabla_EOD, colnames(Tabla_EOD), variables.buscar[i], variables.cambiar[i])
}
}
return(Tabla_EOD)
}
ciudades <- read.csv("Otros/Ciudades_Cedeus.csv")
ciudades <- unique(ciudades$Ciudad)
ciudades <- ciudades[!(ciudades =="Gran Concepcion")]
ciudades <- sort(ciudades)
files.viajes <- list.files("Raw_Data", pattern = "viajes") %>%
sort()
files.modo <- list.files("Raw_Data", pattern = "ModoReclass") %>%
sort()
particion.modal <- data.table()
for (c in seq(files.viajes)){
ciudad.nombre <- ciudades[c]
if (ciudad.nombre %in% c("Gran Santiago")){
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("hogar", "persona", "Viaje_", "ModoAgregado"),
c("IDFolio", "IDPersona", "IDViaje", "IDModo")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""), sep = ";")
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(ModoAgregado == "Transporte Privado/Auto")/n(),2),
'Transporte Publico' = round(100*sum(ModoAgregado == "Transporte Publico")/n(),2),
Bicicleta = round(100*sum(ModoAgregado == "Bicicleta")/n(),2),
Caminata = round(100*sum(ModoAgregado == "Caminata")/n(),2),
Otros = round(100*sum(ModoAgregado == "Otros")/n(),2),
Total = 1)
}
else if (ciudad.nombre == "Gran Coquimbo") {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje"),
c("IDFolio", "IDPersona", "IDViaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(ModoAgregado == "Transporte Privado/Auto")/n(),2),
'Transporte Publico' = round(100*sum(ModoAgregado == "Transporte Publico")/n(),2),
Bicicleta = round(100*sum(ModoAgregado == "Bicicleta")/n(),2),
Caminata = round(100*sum(ModoAgregado == "Caminata")/n(),2),
Otros = round(100*sum(ModoAgregado == "Otros")/n(),2),
Total = 1)
} else {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje", "Factor_"),
c("IDFolio", "IDPersona", "IDViaje", "Factor_Viaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "Factor_Viaje", "IDModo"))
viajes$Factor_Viaje <- as.numeric(gsub(",", ".", viajes$Factor_Viaje))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(Factor_Viaje[ModoAgregado == "Transporte Privado/Auto"])/sum(Factor_Viaje),2),
'Transporte Publico' = round(100*sum(Factor_Viaje[ModoAgregado == "Transporte Publico"])/sum(Factor_Viaje),2),
Bicicleta = round(100*sum(Factor_Viaje[ModoAgregado == "Bicicleta"])/sum(Factor_Viaje),2),
Caminata = round(100*sum(Factor_Viaje[ModoAgregado == "Caminata"])/sum(Factor_Viaje),2),
Otros = round(100*sum(Factor_Viaje[ModoAgregado == "Otros"])/sum(Factor_Viaje),2),
Total = 1)
}
particion.modal <- rbind(particion.modal, viajes.summary)
}
View(particion.modal)
# Script para calcular la partición modal de cada ciudad.
# Input: Tablas de Viajes, encontradas dentro de la EOD de cada ciudad.
#        Tablas con las reclasificaciones de los modos de transporte de cada viaje.
#         para agruparlos en 5 categorías.
# Output: Tabla con la partición modal de cada ciudad.
library(data.table); library(dplyr)
# Carpeta donde se encuentra el script. Modificar según necesidades del usuario.
setwd("C:/Users/Rodrigo Villegas/Documents/Cedeus_ISCh/Cedeus_ISCh/14. Partición Modal/")
# Funciones de ayuda:
# Corrector.nombre:
#   Input: nombres de columna, data.frame, variable a buscar (persona, tiempo, etc...)
#          variable a cambiar (IDPersona, TiempoViajes, etc)
#   Output: Dataset con nombre de variable cambiado.
# Nota: Acepta sólo una variable.
Corrector.nombre <- function(dataset, nombres, variable.buscar, variable.cambiar, exact.match = F){
if (exact.match == T){
colname <- grep(paste("^", variable.buscar, "$", sep = ""), nombres, ignore.case = T)
} else {
colname <- grep(variable.buscar, nombres, ignore.case = T)
}
if (colnames(dataset)[colname] != variable.cambiar){
colnames(dataset)[colname] <- variable.cambiar
}
return(dataset)
}
# Estandarizador:
#   Input: Tabla EOD en bruto
#   Output: Tabla EOD estandarizada
#   Nota: cuando una variable tiene el sufijo "_", se ejecuta "exact.macth" de Corrector.nombre
Estandarizador <- function(Tabla_EOD, variables.buscar, variables.cambiar){
for (i in seq(variables.buscar)){
if (grepl("_", variables.buscar[i])){
variables.buscar[i] <- gsub("_", "", variables.buscar[i])
Tabla_EOD <- Corrector.nombre(Tabla_EOD, colnames(Tabla_EOD), variables.buscar[i], variables.cambiar[i], exact.match = T)
} else {
Tabla_EOD <- Corrector.nombre(Tabla_EOD, colnames(Tabla_EOD), variables.buscar[i], variables.cambiar[i])
}
}
return(Tabla_EOD)
}
ciudades <- read.csv("Otros/Ciudades_Cedeus.csv")
ciudades <- unique(ciudades$Ciudad)
ciudades <- ciudades[!(ciudades =="Gran Concepcion")]
ciudades <- sort(ciudades)
files.viajes <- list.files("Raw_Data", pattern = "viajes") %>%
sort()
files.modo <- list.files("Raw_Data", pattern = "ModoReclass") %>%
sort()
particion.modal <- data.table()
for (c in seq(files.viajes)){
ciudad.nombre <- ciudades[c]
if (ciudad.nombre %in% c("Gran Santiago")){
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("hogar", "persona", "Viaje_", "ModoAgregado"),
c("IDFolio", "IDPersona", "IDViaje", "IDModo")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""), sep = ";")
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(ModoAgregado == "Transporte Privado/Auto")/n(),2),
'Transporte Publico' = round(100*sum(ModoAgregado == "Transporte Publico")/n(),2),
Bicicleta = round(100*sum(ModoAgregado == "Bicicleta")/n(),2),
Caminata = round(100*sum(ModoAgregado == "Caminata")/n(),2),
Otros = round(100*sum(ModoAgregado == "Otros")/n(),2),
Total = 100)
}
else if (ciudad.nombre == "Gran Coquimbo") {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje"),
c("IDFolio", "IDPersona", "IDViaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "IDModo"))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(ModoAgregado == "Transporte Privado/Auto")/n(),2),
'Transporte Publico' = round(100*sum(ModoAgregado == "Transporte Publico")/n(),2),
Bicicleta = round(100*sum(ModoAgregado == "Bicicleta")/n(),2),
Caminata = round(100*sum(ModoAgregado == "Caminata")/n(),2),
Otros = round(100*sum(ModoAgregado == "Otros")/n(),2),
Total = 100)
} else {
viajes <- read.csv(paste("Raw_Data/", files.viajes[c], sep = ""), sep = ";") %>%
Estandarizador(c("folio", "persona", "idViaje", "Factor_"),
c("IDFolio", "IDPersona", "IDViaje", "Factor_Viaje")) %>%
subset(select = c("IDFolio",  "IDPersona", "IDViaje", "Factor_Viaje", "IDModo"))
viajes$Factor_Viaje <- as.numeric(gsub(",", ".", viajes$Factor_Viaje))
viajes.modo <- read.csv(paste("Raw_Data/", files.modo[c], sep = ""))
viajes <- merge(viajes, viajes.modo, by = "IDModo")
viajes.summary <- viajes %>%
summarise(Ciudad = as.character(ciudad.nombre),
'Transporte Privado/Auto' = round(100*sum(Factor_Viaje[ModoAgregado == "Transporte Privado/Auto"])/sum(Factor_Viaje),2),
'Transporte Publico' = round(100*sum(Factor_Viaje[ModoAgregado == "Transporte Publico"])/sum(Factor_Viaje),2),
Bicicleta = round(100*sum(Factor_Viaje[ModoAgregado == "Bicicleta"])/sum(Factor_Viaje),2),
Caminata = round(100*sum(Factor_Viaje[ModoAgregado == "Caminata"])/sum(Factor_Viaje),2),
Otros = round(100*sum(Factor_Viaje[ModoAgregado == "Otros"])/sum(Factor_Viaje),2),
Total = 100)
}
particion.modal <- rbind(particion.modal, viajes.summary)
}
